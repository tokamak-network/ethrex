# 11. 프루버 경제 모델, 수수료 구조, 운영비

> 프루버 인센티브, L2 수수료 구조, 블록 생성 주기, L1 가스비, 서버 운영비, 채굴형 프루빙 제안

---

## 1. 프루버 구조: 단일 vs 다중

### 다중 프루버, 협력 모델

Ethrex는 **여러 프루버가 동시에 접속**할 수 있으며, 서로 **경쟁이 아닌 협력** 관계이다.

```
                         ProofCoordinator (TCP :3900)
                                  |
                    ┌─────────────┼─────────────┐
                    |             |             |
              ┌─────────┐  ┌─────────┐  ┌─────────┐
              │ SP1 프루버│  │RISC0 프루버│  │TDX 프루버│
              │ (ZK 증명) │  │ (ZK 증명) │  │(TEE 증명)│
              └─────────┘  └─────────┘  └─────────┘
                    |             |             |
                    └─────────────┼─────────────┘
                                  v
                      같은 배치에 대해 각각
                      독립적으로 증명 생성
                      (AND 로직: 모든 필요 타입 충족 시 L1 제출)
```

### 지원 프루버 타입

**파일**: `crates/l2/common/src/prover.rs`

```rust
pub enum ProverType {
    Exec,      // 테스트용 (실제 증명 없음)
    RISC0,     // RISC Zero zkVM
    SP1,       // Succinct SP1 zkVM
    TDX,       // Intel TDX TEE
}
```

### 배포 시 필요 증명 타입 설정

**파일**: `crates/l2/contracts/src/l1/OnChainProposer.sol`

```solidity
bool public REQUIRE_RISC0_PROOF;
bool public REQUIRE_SP1_PROOF;
bool public REQUIRE_TDX_PROOF;
```

- 배포 시 어떤 증명이 필요한지 설정 (AND 로직)
- **모든 필요 타입의 증명이 갖춰져야** L1에 제출 가능
- 같은 타입의 프루버가 여러 개 접속해도 먼저 제출한 것만 저장

### 프루버 접속 흐름

```
프루버 접속:

1. TCP 연결 (인증 없음, 누구나 접속 가능)
      |
2. 프루버 타입 + git commit 해시 전송
      |
3. ProofCoordinator 검증:
   ├── 이 프루버 타입이 필요한가? --> 아니면 ProverTypeNotNeeded
   ├── git 해시가 일치하는가?     --> 아니면 VersionMismatch
   └── 증명할 배치가 있는가?      --> 없으면 RetryLater
      |
4. 배치 데이터 전송 --> 프루버 증명 생성 --> 결과 반환
```

### L1ProofSender: 모든 증명 수집 후 전송

**파일**: `crates/l2/sequencer/l1_proof_sender.rs`

```rust
// 모든 필요 증명이 모여야 L1에 전송
for proof_type in &self.needed_proof_types {
    if let Some(proof) = rollup_store.get_proof_by_batch_and_type(batch, *proof_type) {
        proofs.insert(*proof_type, proof);
    } else {
        missing_proof_types.push(proof_type);  // 아직 미수신 --> 대기
    }
}
if missing_proof_types.is_empty() {
    self.send_proof_to_contract(batch, proofs).await?;  // 전부 모임 --> L1 전송
}
```

---

## 2. 프루버 경제적 인센티브

### 프로토콜 레벨 보상: 없음

| 항목 | 시퀀서 | 프루버 |
|------|--------|--------|
| **등록** | SequencerRegistry에 등록 필요 | 등록 불필요 (TCP 접속만) |
| **담보** | 최소 1 ETH 담보금 | 없음 |
| **온체인 보상** | 수수료 수입 (operator fee, base fee) | **없음** |
| **토큰 보상** | - | **없음** |
| **가스 환급** | - | **없음** |
| **스테이킹** | 있음 (Based 모드) | **없음** |

### 프루버는 시퀀서의 인프라

```
┌──────────────────────────────────────────────────────────┐
│                  시퀀서 운영자                              │
│                                                          │
│  수입:                                                    │
│  ├── L2 사용자 수수료 (base fee --> base_fee_vault)       │
│  ├── 운영자 수수료 (operator_fee_per_gas)                 │
│  └── MEV (트랜잭션 순서 결정권)                            │
│                                                          │
│  지출:                                                    │
│  ├── L1 가스비 (commitBatch, verifyBatch)                 │
│  ├── 프루버 운영 비용 (하드웨어, 전기)                      │
│  └── 담보금 (1 ETH, Based 모드)                           │
│                                                          │
│  프루버는 시퀀서의 비용 항목:                                │
│  ├── 자체 프루버 운영 (가장 일반적)                         │
│  ├── 외부 프루버 서비스에 오프체인 결제                      │
│  └── 프루버 마켓플레이스 활용 (미래)                        │
└──────────────────────────────────────────────────────────┘
```

Based 모드 문서에서 명시:
> *"For this stage, it is the Sequencers' responsibility to prove their own batches."*

---

## 3. L2 수수료 구조

### 사용자가 지불하는 총 수수료

```
총 수수료 = gas_used x gas_price

gas_price 분배:
┌───────────────────────────────────────────────────────────────┐
│                                                               │
│  gas_price = base_fee + operator_fee + priority_fee           │
│              ────┬───   ─────┬─────   ────┬─────              │
│                  |           |             |                   │
│                  v           v             v                   │
│          base_fee_vault  operator_fee  coinbase(시퀀서)        │
│          (소각 또는 금고) _vault(운영금고) (팁)                  │
│                                                               │
│  + L1 Fee (별도 계산)                                          │
│    └─ l1_fee_vault (L1 블롭 비용 충당)                         │
└───────────────────────────────────────────────────────────────┘
```

### 수수료 요소별 상세

**파일**: `crates/common/types/l2/fee_config.rs`

```rust
pub struct FeeConfig {
    pub base_fee_vault: Option<Address>,           // Base Fee 수신 주소
    pub operator_fee_config: Option<OperatorFeeConfig>,  // 운영자 수수료
    pub l1_fee_config: Option<L1FeeConfig>,        // L1 비용 수수료
}

pub struct OperatorFeeConfig {
    pub operator_fee_vault: Address,    // 수신 주소
    pub operator_fee_per_gas: u64,      // 가스당 수수료 (wei)
}

pub struct L1FeeConfig {
    pub l1_fee_vault: Address,          // 수신 주소
    pub l1_fee_per_blob_gas: u64,       // 블롭 가스당 수수료
}
```

### 각 수수료 요소의 특성

| 수수료 요소 | 시퀀서 제어 가능? | 0 설정 가능? | 결정 방식 |
|------------|----------------|------------|----------|
| **Base Fee** | **불가능** | 블록이 비면 자연 하락 | EIP-1559 자동 계산, ZK 검증 |
| **Operator Fee** | **가능** (CLI) | **가능** | `--block-producer.operator-fee-per-gas` |
| **L1 Fee** | **간접적** | **가능** (손해) | L1 블롭 가스 가격 연동 |
| **Priority Fee** | 불가능 | 사용자가 0 설정 가능 | 사용자 설정 (팁) |

### Base Fee 계산 (EIP-1559)

**파일**: `crates/common/types/block.rs`

```rust
// 이전 블록 가스 사용량이 target 초과 --> base_fee 증가
let base_fee_per_gas_delta = max(
    target_fee_gas_delta / BASE_FEE_MAX_CHANGE_DENOMINATOR, 1
);
parent_base_fee_per_gas + base_fee_per_gas_delta

// 이전 블록 가스 사용량이 target 미만 --> base_fee 감소
let base_fee_per_gas_delta = target_fee_gas_delta / BASE_FEE_MAX_CHANGE_DENOMINATOR;
parent_base_fee_per_gas - base_fee_per_gas_delta
```

- **조작 불가**: zkVM에서 `validate_block()` 시 expected와 actual base_fee 비교 → 불일치 시 실패
- **자동 조절**: 블록 사용률에 따라 자동으로 오르내림

### TX 검증 시 수수료 체크

**파일**: `crates/vm/levm/src/hooks/l2_hook.rs`

```rust
fn validate_sufficient_max_fee_per_gas_l2(vm, operator_fee_config) {
    let total_fee = base_fee_per_gas + operator_fee_per_gas;
    if tx_max_fee_per_gas < total_fee {
        return Err(InsufficientMaxFeePerGas);  // TX 거부
    }
}
```

### 수수료 분배 흐름 (TX 실행 후)

**파일**: `crates/vm/levm/src/hooks/l2_hook.rs`

```
TX 실행 완료 후:

1. L1 Fee 계산 및 지불
   └─ l1_fee = (l1_fee_per_blob_gas x GAS_PER_BLOB / SAFE_BYTES_PER_BLOB) x tx_size
   └─ pay_to_l1_fee_vault(l1_fee_vault, l1_fee)

2. Coinbase(시퀀서) 팁 지불
   └─ priority_fee = gas_price - base_fee - operator_fee
   └─ coinbase_fee = gas_used x priority_fee
   └─ increase_account_balance(coinbase, coinbase_fee)

3. Base Fee 지불
   └─ base_fee_total = gas_used x base_fee_per_gas
   └─ pay_base_fee_vault(base_fee_vault, base_fee_total)
   └─ (vault 미설정 시 ETH 소각, ERC20은 zero address 전송)

4. Operator Fee 지불
   └─ operator_fee = gas_used x operator_fee_per_gas
   └─ pay_operator_fee(operator_fee_vault, operator_fee)
```

### 시퀀서가 수수료를 극단적으로 변경하면?

```
수수료를 0으로 낮추면:
├── 사용자: 거의 무료 TX (base_fee만, 블록 비면 이것도 0에 수렴)
├── 시퀀서 수입: 0
├── 시퀀서 지출: L1 커밋/검증 가스비 + 프루버 비용 (여전히 발생)
└── 결과: 적자 운영 --> 지속 불가능

수수료를 매우 높이면:
├── max_fee_per_gas >= base_fee + operator_fee 필요
├── 사용자가 높은 수수료 거부 --> TX 안 보냄 --> 블록 비어짐
├── 블록 비어지면 base_fee 자연 하락
└── 시장 경쟁: 사용자가 다른 L2로 이탈
```

---

## 4. 블록 생성 주기

### 기본 설정

**파일**: `cmd/ethrex/l2/options.rs`

```rust
// 기본값
pub block_time_ms: u64 = 5000;          // 5초
pub block_gas_limit: u64 = 30_000_000;  // 30M gas
```

CLI 설정:
```bash
ethrex l2 --block-producer.block-time 5000       # 밀리초 단위
          --block-producer.block-gas-limit 30000000
```

환경 변수:
```bash
ETHREX_BLOCK_PRODUCER_BLOCK_TIME=5000
ETHREX_BLOCK_PRODUCER_BLOCK_GAS_LIMIT=30000000
```

### BlockProducer 동작 방식

**파일**: `crates/l2/sequencer/block_producer.rs`

```rust
// 블록 생성 후 block_time_ms 이후 다음 블록 생성
send_after(
    Duration::from_millis(self.block_time_ms),  // 5000ms = 5초
    handle.clone(),
    Self::CastMsg::Produce,  // Produce 메시지 전송 --> 블록 생성
);
```

- GenServer 액터 모델로 동작
- `Produce` 메시지 수신 시 블록 생성
- 생성 완료 후 `block_time_ms` 후에 다시 `Produce` 메시지 예약

### 시간당 블록 수

| block_time_ms 설정 | 블록/분 | 블록/시간 | 블록/일 |
|-------------------|---------|----------|--------|
| 1,000 (1초) | 60 | 3,600 | 86,400 |
| 2,000 (2초) | 30 | 1,800 | 43,200 |
| **5,000 (5초, 기본)** | **12** | **720** | **17,280** |
| 10,000 (10초) | 6 | 360 | 8,640 |

### 배치 구성

| 설정 | 기본값 | 설명 |
|------|--------|------|
| `commit_time_ms` | 60,000 (60초) | 배치 커밋 주기 |
| `batch_gas_limit` | 설정 가능 | 배치 최대 가스 |
| 배치당 블록 수 | ~12개 (60초/5초) | commit_time / block_time |

---

## 5. L1 가스비

### 시퀀서가 L1에 지불하는 비용 (배치당)

```
배치당 L1 비용 = commitBatch 가스 + verifyBatch 가스 + 블롭 가스
```

| L1 트랜잭션 | 가스 소비 (추정) | 설명 |
|------------|---------------|------|
| **commitBatch** | ~100,000~300,000 gas | 배치 메타데이터 + calldata 저장 |
| **verifyBatch** (Groth16) | ~250,000~350,000 gas | ZK 증명 검증 (pairing 연산) |
| **블롭 가스** (EIP-4844) | 131,072 blob gas/블롭 | 블롭 1개당 고정, 별도 가스 시장 |

### 가스비 추적 코드

**파일**: `crates/l2/sequencer/l1_committer.rs`

```rust
// 커밋 가스 기록
let commit_gas_used = commit_tx_receipt.tx_info.gas_used;
METRICS.set_batch_commitment_gas(batch.number, commit_gas_used);

// 블롭 가스 기록 (롤업 모드)
let blob_gas_used = commit_tx_receipt.tx_info.blob_gas_used;
METRICS.set_batch_commitment_blob_gas(batch.number, blob_gas_used);
```

**파일**: `crates/l2/sequencer/l1_proof_sender.rs`

```rust
// 검증 가스 기록
let verify_gas_used = verify_tx_receipt.tx_info.gas_used;
METRICS.set_batch_verification_gas(batch_number, verify_gas_used);
```

### 비용 추정 예시

L1 가스 가격 = 30 gwei, 블롭 가스 가격 = 1 gwei 가정:

```
commitBatch:
├── 실행 가스: ~200,000 gas x 30 gwei = 0.006 ETH
└── 블롭 가스: 131,072 blob gas x ~1 gwei = 0.000131 ETH

verifyBatch (Groth16 증명):
└── 실행 가스: ~300,000 gas x 30 gwei = 0.009 ETH

배치당 총 L1 비용 ≈ 0.015 ETH
```

### TX당 L1 비용 (배치 크기에 따른 분산)

```
배치 = 60초간 생성된 블록 (~12블록)

블록당 L1 비용 = 배치당 L1 비용 / 블록 수
              ≈ 0.015 ETH / 12 = 0.00125 ETH/블록
```

| 배치당 TX 수 | TX당 L1 비용 (추정) | 참고 |
|-------------|-------------------|------|
| 10 TX | ~0.0015 ETH | 저트래픽 |
| 100 TX | ~0.00015 ETH | 보통 |
| 1,000 TX | ~0.000015 ETH | 고트래픽 |
| 10,000 TX | ~0.0000015 ETH | 매우 높은 트래픽 |

**TX가 많을수록 1건당 L1 비용이 급격히 줄어든다.** 이것이 L2 롤업의 핵심 경제 모델이다. 블롭 비용은 배치당 고정이고, 그 안에 TX를 많이 담을수록 개별 비용이 분산된다.

### L1 비용 vs L2 수수료 수입 손익분기점

```
손익분기:
  L2 수수료 수입 >= L1 비용 + 프루버 비용

  가정: operator_fee = 0.001 gwei/gas, 평균 TX gas = 50,000
  TX당 operator 수입 = 50,000 x 0.001 gwei = 50 gwei = 0.00000005 ETH

  L1 비용 회수에 필요한 TX 수:
  = 0.015 ETH / 0.00000005 ETH
  = 300,000 TX/배치

  --> operator_fee를 더 높이거나, base_fee 수입을 합산해야 손익분기
```

---

## 6. 시퀀서 수입/지출 정리

```
┌──────────────────────────────────────────────────────────────────┐
│                    시퀀서 경제 모델                                │
│                                                                  │
│  수입 (배치당):                                                   │
│  ├── Base Fee 수입: gas_used x base_fee (vault 설정 시)          │
│  ├── Operator Fee: gas_used x operator_fee_per_gas               │
│  ├── Priority Fee (팁): gas_used x (gas_price - base - operator) │
│  └── L1 Fee 수입: tx_size 기반 L1 비용 전가                      │
│                                                                  │
│  지출 (배치당):                                                   │
│  ├── commitBatch L1 가스: ~0.006 ETH                             │
│  ├── verifyBatch L1 가스: ~0.009 ETH                             │
│  ├── 블롭 가스: ~0.000131 ETH                                    │
│  └── 프루버 운영비: 하드웨어/전기/외주 (오프체인)                   │
│                                                                  │
│  핵심: TX 볼륨이 높을수록 수익성 증가                              │
│  (L1 비용은 배치당 고정, 수입은 TX 수에 비례)                      │
└──────────────────────────────────────────────────────────────────┘
```

---

## 7. 코드 참조

| 파일 | 설명 |
|------|------|
| `crates/common/types/l2/fee_config.rs` | FeeConfig, OperatorFeeConfig, L1FeeConfig 구조체 |
| `crates/vm/levm/src/hooks/l2_hook.rs` | L2 수수료 검증/분배 로직 |
| `crates/common/types/block.rs` | EIP-1559 base_fee 계산 (`calculate_base_fee_per_gas`) |
| `cmd/ethrex/l2/options.rs` | CLI 옵션 기본값 (block_time, gas_limit, fees) |
| `crates/l2/sequencer/block_producer.rs` | 블록 생성 루프, block_time_ms 사용 |
| `crates/l2/sequencer/l1_committer.rs` | 배치 커밋, L1 가스 추적 |
| `crates/l2/sequencer/l1_proof_sender.rs` | 증명 전송, 검증 가스 추적 |
| `crates/l2/sequencer/proof_coordinator.rs` | 다중 프루버 관리, TCP 서버 |
| `crates/l2/prover/src/prover.rs` | 프루버 polling 루프 |
| `crates/l2/common/src/prover.rs` | ProverType 정의 |
| `crates/l2/contracts/src/l1/based/SequencerRegistry.sol` | 시퀀서 등록/담보금 |

---

## 8. 서버 운영비 추정

### L1 노드 서버

**하드웨어 요구사항** (`docs/getting-started/hardware_requirements.md`):

| 항목 | 메인넷 | 테스트넷 (Sepolia/Holesky) |
|------|--------|---------------------------|
| CPU | 4-8 코어 | 2-4 코어 |
| RAM | 32-64 GB | 16-32 GB |
| 디스크 | 500GB-1TB NVMe SSD | 200-500GB NVMe SSD |
| 네트워크 | 100 Mbps+ | 50 Mbps+ |

**월 클라우드 비용 추정** (AWS 기준):
- `m6i.2xlarge` (8 vCPU, 32GB) + 1TB gp3 SSD ≈ **$250-350/월**
- `m6i.4xlarge` (16 vCPU, 64GB) + 1TB io2 SSD ≈ **$500-700/월** (권장)

### L2 시퀀서 노드

| 항목 | 최소 | 권장 |
|------|------|------|
| CPU | 4 코어 | 8 코어 |
| RAM | 16 GB | 32 GB |
| 디스크 | 100 GB NVMe SSD | 500 GB NVMe SSD |
| 네트워크 | 50 Mbps+ | 100 Mbps+ |

> L2 시퀀서는 L1보다 가벼움 — 상태가 작고, P2P 피어 수도 적음

**월 클라우드 비용 추정**:
- `m6i.xlarge` (4 vCPU, 16GB) + 500GB gp3 ≈ **$150-200/월**
- `m6i.2xlarge` (8 vCPU, 32GB) + 500GB gp3 ≈ **$250-350/월** (권장)

### 프루버 서버 (가장 비용이 큰 항목)

**벤치마크 서버 사양** (`docs/l2/bench/prover_performance.md`):

| 항목 | 사양 |
|------|------|
| CPU | AMD EPYC 7713 64-Core |
| RAM | 128 GB |
| GPU | NVIDIA RTX 4090 24GB (SP1 GPU 가속) |
| CUDA | 12.9 |

**SP1 증명 생성 시간**:

| 블록 가스 사용량 | 증명 시간 |
|-----------------|-----------|
| 낮은 가스 (~1M) | ~2분 |
| 중간 가스 (~15M) | ~5-7분 |
| 높은 가스 (~30M) | ~12분 |

**월 클라우드 비용 추정**:
- AWS `p3.2xlarge` (V100 GPU) ≈ **$2,200/월** (성능 부족 가능)
- AWS `g5.16xlarge` (A10G GPU, 64 vCPU, 256GB) ≈ **$3,500-5,000/월**
- 전용 서버 (Hetzner 등, RTX 4090 탑재) ≈ **$500-800/월**
- 자체 서버 구매 시: 초기 $5,000-8,000 + 전기/호스팅 $100-200/월

### 월간 L1 가스비 (온체인 비용)

```
배치당 ~0.015 ETH (30 gwei 기준)

배치 빈도별 월간 가스비:
├── 보수적 (5분 간격):  288 배치/일 → ~130 ETH/월 (~$325K)
├── 일반적 (1분 간격): 1,440 배치/일 → ~648 ETH/월 (~$1.6M)
└── 경제적 (10분 간격): 144 배치/일 → ~65 ETH/월  (~$162K)
```

### 전체 운영비 요약

| 항목 | 월 비용 (USD) | 비고 |
|------|--------------|------|
| L1 노드 서버 | $300-700 | 클라우드 기준 |
| L2 시퀀서 서버 | $200-350 | 클라우드 기준 |
| 프루버 서버 | $500-5,000 | 전용 vs 클라우드 |
| **서버 소계** | **$1,000-6,050** | |
| L1 가스비 (5분 배치) | ~$325,000 | 메인넷, 30 gwei |
| L1 가스비 (10분 배치) | ~$162,000 | 메인넷, 30 gwei |
| **총 운영비** | **$163K-331K/월** | **가스비가 95% 이상** |

```
핵심 인사이트:
├── 가스비가 운영비의 95% 이상 — 서버 비용은 미미
├── 배치 빈도가 핵심 변수 — 10분 vs 1분은 10배 차이
├── 프루버가 서버 비용의 최대 항목 — GPU 필수
├── 가스비 절감 전략: EIP-4844 블롭 사용(기본), 배치 크기 증가, 저가 시간대 활용
└── 테스트넷은 무료 — 가스비 없음, 서버만 $500-1,000/월
```

---

## 9. 토카막 채굴형 프루빙 경제 모델 제안

### 현재 ethrex 모델의 한계

```
ethrex 현재:
├── 프루버 = 시퀀서의 인프라 비용 (보상 없음)
├── 시퀀서가 직접 프루버 운영 (중앙화)
├── ProofCoordinator에 TCP 접속은 누구나 가능하지만 경제적 동기 없음
└── 프루버 탈중앙화 인센티브 부재
```

### 제안: 채굴형 프루빙 (Proof-of-Proof Mining)

```
┌─────────────────────────────────────────────────────────────┐
│                 채굴형 프루빙 경제 모델                        │
│                                                             │
│  프루버 (누구나 참여) ──→ 배치 증명 생성 ──→ L1 검증 통과     │
│                                              │              │
│                                              v              │
│                                    ┌──────────────────┐     │
│                                    │ 토큰 발행 (채굴)   │     │
│                                    │ (프루빙 = 채굴)    │     │
│                                    └────────┬─────────┘     │
│                                             │               │
│                                             v               │
│                                    ┌──────────────────┐     │
│                                    │ 시뇨리지 교환      │     │
│                                    │ (토큰 → 경제적    │     │
│                                    │  가치로 전환)      │     │
│                                    └──────────────────┘     │
│                                                             │
│  PoW 채굴과의 유사성:                                        │
│  ├── GPU/CPU 연산 자원 소비 → 증명 생성 (= 해시 계산)        │
│  ├── 먼저 유효한 증명 제출 → 보상 (= 블록 발견)              │
│  ├── 난이도 없음, 대신 배치당 고정 연산량                     │
│  └── 누구나 참여 가능 (permissionless)                       │
└─────────────────────────────────────────────────────────────┘
```

### 설계 고려사항

| 항목 | 고려사항 |
|------|----------|
| **증명 경쟁** | 같은 배치를 여러 프루버가 경쟁? 먼저 제출한 사람만 보상? |
| **토큰 발행량** | 배치당 고정? 난이도 연동? 반감기? |
| **시뇨리지 원천** | L2 수수료 수익 → 토큰 바이백? 프로토콜 수익 공유? |
| **프루빙 비용** | GPU 서버 $500-5,000/월 → 토큰 보상이 이를 상회해야 참여 동기 |
| **품질 보장** | 잘못된 증명 제출 시 슬래싱? 스테이킹 요구? |
| **지연 방지** | 프루버 부재 시 배치 지연 → 폴백 프루버 필요? |

### ethrex 코드에서 활용 가능한 부분

```
기존 인프라 활용:
├── ProofCoordinator  — 이미 다중 프루버 TCP 접속 지원
├── ProverType 관리   — 배치별 증명 타입별 관리 이미 구현
├── verifyBatch()     — L1에서 증명 검증 후 토큰 민팅 훅 추가 가능
└── 접속 인증 없음    — 이미 permissionless 구조

추가 개발 필요:
├── 증명 경쟁 로직 (먼저 제출한 프루버에게 보상)
├── 토큰 민팅 컨트랙트 (verifyBatch 성공 시 자동 발행)
├── 시뇨리지 교환 메커니즘
├── 프루버 등록/스테이킹 (선택적)
└── 보상 분배 정책 (고정 vs 경매 vs 비례)
```

### PoW 채굴 vs 프루빙 채굴 비교

| 항목 | PoW 채굴 | 프루빙 채굴 |
|------|---------|------------|
| 연산 | 의미 없는 해시 반복 | **유용한 ZK 증명 생성** |
| 보상 | 블록 보상 + TX 수수료 | 토큰 발행 + 시뇨리지 |
| 경쟁 | 가장 빠른 해시 발견 | 가장 빠른 증명 제출 |
| 난이도 | 동적 조절 | 배치 크기에 비례 (자연 난이도) |
| 에너지 낭비 | 매우 큼 | **없음** (모든 연산이 유용) |
| 하드웨어 | ASIC/GPU | GPU (CUDA) |

> **핵심 차별점**: PoW는 에너지를 낭비하지만, 프루빙 채굴은 **모든 연산이 L2 보안에 직접 기여**한다. "유용한 작업 증명(Useful Proof-of-Work)"이라 할 수 있다.

---

## 10. 코드 참조

| 파일 | 설명 |
|------|------|
| `crates/common/types/l2/fee_config.rs` | FeeConfig, OperatorFeeConfig, L1FeeConfig 구조체 |
| `crates/vm/levm/src/hooks/l2_hook.rs` | L2 수수료 검증/분배 로직 |
| `crates/common/types/block.rs` | EIP-1559 base_fee 계산 (`calculate_base_fee_per_gas`) |
| `cmd/ethrex/l2/options.rs` | CLI 옵션 기본값 (block_time, gas_limit, fees) |
| `crates/l2/sequencer/block_producer.rs` | 블록 생성 루프, block_time_ms 사용 |
| `crates/l2/sequencer/l1_committer.rs` | 배치 커밋, L1 가스 추적 |
| `crates/l2/sequencer/l1_proof_sender.rs` | 증명 전송, 검증 가스 추적 |
| `crates/l2/sequencer/proof_coordinator.rs` | 다중 프루버 관리, TCP 서버 |
| `crates/l2/prover/src/prover.rs` | 프루버 polling 루프 |
| `crates/l2/common/src/prover.rs` | ProverType 정의 |
| `crates/l2/contracts/src/l1/based/SequencerRegistry.sol` | 시퀀서 등록/담보금 |
| `docs/getting-started/hardware_requirements.md` | L1 하드웨어 요구사항 |
| `docs/l2/bench/prover_performance.md` | 프루버 벤치마크 (SP1 증명 시간) |

---

*분석일: 2026-02-21*
